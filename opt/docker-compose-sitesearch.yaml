version: "2.0"
services:

  sitesearch-search-service:
    image: intrafind/sitesearch-search-service:latest
    container_name: sitesearch-search-service
    restart: always
    depends_on:
      - sitesearch-elasticsearch
      - sitesearch-elasticsearch-1
    ports:
      - 9605:9605
    networks:
      - sitesearch

  sitesearch-elasticsearch:
    image: intrafind/sitesearch-elasticsearch:latest
    container_name: sitesearch-elasticsearch
    restart: always
    environment:
      - unicast_hosts=sitesearch-elasticsearch:9300, sitesearch-elasticsearch-1:9300
      - minimum_master_nodes=2
#      - cluster.name=elasticsearch
#      - bootstrap.memory_lock=true
#      - "ES_JAVA_OPTS=-Xms512m -Xmx1g"
#      - "discovery.zen.ping.unicast.hosts=ops-elasticsearch"
    volumes:
      - $HOME/srv/sitesearch-elasticsearch/data:/home/app_user/data:rw
    networks:
      - sitesearch

  sitesearch-elasticsearch-1:
    image: intrafind/sitesearch-elasticsearch:latest
    container_name: sitesearch-elasticsearch-1
    restart: always
    environment:
      - unicast_hosts=sitesearch-elasticsearch:9300, sitesearch-elasticsearch-1:9300
      - minimum_master_nodes=2
#      - cluster.name=elasticsearch
#      - bootstrap.memory_lock=true
#      - "ES_JAVA_OPTS=-Xms512m -Xmx1g"
#      - "discovery.zen.ping.unicast.hosts=ops-elasticsearch"   # TODO replace unicast_hosts with THIS?
    volumes:
      - $HOME/srv/sitesearch-elasticsearch-1/data:/home/app_user/data:rw
    networks:
      - sitesearch

#  sitesearch-elasticsearch-2:
#    image: intrafind/sitesearch-elasticsearch:latest
#    container_name: sitesearch-elasticsearch-2
#    restart: always
#    environment:
#      - unicast_hosts=sitesearch-elasticsearch:9300, sitesearch-elasticsearch-1:9300, sitesearch-elasticsearch-2:9300
#      - minimum_master_nodes=1    # TODO adjust other services to 1?
##      - cluster.name=elasticsearch
##      - bootstrap.memory_lock=true
##      - "ES_JAVA_OPTS=-Xms512m -Xmx1g"
##      - "discovery.zen.ping.unicast.hosts=ops-elasticsearch"
#    volumes:
#      - $HOME/srv/sitesearch-elasticsearch-2/data:/home/app_user/data:rw
#    networks:
#      - sitesearch

#volumes:
#  sitesearch-elasticsearch:
#    driver: local

networks:
  sitesearch:
    external:
      name: sitesearch