<!DOCTYPE html>
<!--
  ~ Copyright 2017 IntraFind Software AG. All rights reserved.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<meta charset="utf-8"/>
<title>Sitesearch</title>
<link rel="stylesheet" type="text/css" href="searchbar/css/app.css"/>

<script>
    const setFeedUrl = function () {
//        document.getElementById("feedUrl").setAttribute("value", window.location.href);
    };

    const triggerFirstUsageOwnership = function (feedUrl) {
        const xhr = new XMLHttpRequest();
        xhr.open("PUT", "http://sitesearch.cloud/sites/rss?feedUrl=" + feedUrl);
        xhr.onload = function () {
            document.getElementById('tenantId').value = JSON.parse(this.response)['tenantId'];
            document.cookie = "override-tenant = " + JSON.parse(this.response)['tenantId'];
            document.getElementById('tenantSecret').value = JSON.parse(this.response)['tenantSecret'];
        };
        xhr.send();
    }
</script>

<style>
    label {
        font-weight: bold;
    }

    .wrapper {
        display: grid;
        grid-template-columns: 100px 400px;
    }

    label, input {
        border-radius: .1em;
    }

    #index {
        text-align: center;
        font-weight: bold;
        width: 500px;
    }
</style>
<body onload="setFeedUrl();">
<div class="wrapper">
    <label for="feedUrl">Feed URL</label>
    <input id="feedUrl" placeholder="Feed URL"
           value="http://intrafind.de/share/enterprise-search-blog.xml">
    <label for="tenantId">Tenant ID</label>
    <input id="tenantId" placeholder="Tenant ID">
    <label for="tenantId">Tenant Secret</label>
    <input id="tenantSecret" placeholder="Tenant Secret">
</div>
<button id="index" onclick="triggerFirstUsageOwnership(document.getElementById('feedUrl').value)">
    Create Index
</button>

<div class="container" style="margin-top:0; font-size: 3em;">
    <div id="searchbar"></div>
    <div id="resultlist" style="margin-top:20px;"></div>
</div>

<script src="searchbar/js/app.js"></script>
<script>
    jQuery.noConflict();
    jQuery(document).ready(function ($) {

        IFS.initClient({
            sbTarget: '#searchbar',
            rlTarget: '#resultlist',
            configurl: 'searchbar/data/config.json',
            sitesearch: false,
            cors: true,
            withCredentials: true,
            multiple: false
        });
    });
</script>